{"version":3,"sources":["../src/core/auth-client.ts","../src/lib/request.ts","../src/lib/error.ts","../src/utils/common.ts","../src/utils/storage.ts","../src/core/entity-client.ts","../src/core/entities-client.ts","../src/core/functions-client.ts","../src/tools/ai-tool.ts","../src/tools/email-tool.ts","../src/tools/file-tool.ts","../src/core/tools-client.ts","../src/core/lumi-client.ts"],"sourcesContent":["import type { LumiClient } from '@/core/lumi-client'\nimport type { ApiResponse } from '@/lib/request'\nimport { v4 } from 'uuid'\nimport { MessageType, StorageKey } from '@/constants'\nimport { request } from '@/lib/request'\nimport { getIcon, getTitle, isServer } from '@/utils/common'\nimport { getStorage, setStorage } from '@/utils/storage'\n\nexport interface User {\n  userId: string\n  email: string\n  userName: string\n  userRole: 'ADMIN' | 'USER'\n  createdTime: string\n}\n\nexport interface MessageSignInData {\n  projectId: string\n  accessToken: string\n  user: User\n}\n\nexport type MessageDataReceive = {\n  type: MessageType.READY\n} | {\n  type: MessageType.SIGN_IN\n  data: MessageSignInData\n}\n\nexport interface MessageInitData {\n  projectId: string\n  icon: string | null\n  title: string | null\n}\n\nexport interface MessageDataSend {\n  type: MessageType.INIT\n  data: MessageInitData\n}\n\nexport class LumiAuthClient {\n  readonly #lumi: LumiClient\n  readonly #popupName: string = `lumi-auth-${v4()}`\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n    Promise.resolve().then(() => {\n      if (!isServer && this.isAuthenticated)\n        void this.refreshUser()\n    })\n  }\n\n  /** 访问令牌 */\n  public get accessToken(): string | null {\n    if (isServer) {\n      const authorization = this.#lumi.config.authorization\n      return authorization ? authorization.replace('Bearer ', '') : null\n    }\n    return getStorage<string>(StorageKey.ACCESS_TOKEN)\n  }\n\n  public set accessToken(accessToken: string | null) {\n    if (isServer) {\n      this.#lumi.config.authorization = accessToken ? `Bearer ${accessToken}` : undefined\n      return\n    }\n    setStorage(StorageKey.ACCESS_TOKEN, accessToken)\n  }\n\n  #user: User | null = null\n\n  /** 用户 */\n  public get user(): User | null {\n    if (isServer)\n      return this.#user\n    return getStorage<User>(StorageKey.USER)\n  }\n\n  public set user(user: User | null) {\n    if (isServer) {\n      this.#user = user\n      return\n    }\n    setStorage(StorageKey.USER, user)\n  }\n\n  public get isAuthenticated(): boolean {\n    return !!this.accessToken\n  }\n\n  /** 登录 */\n  public signIn(): Promise<MessageSignInData> {\n    if (isServer)\n      throw new Error('auth.signIn() can only be called on the client side')\n\n    const width = 800\n    const height = 600\n    const left = (window.screen.width - width) / 2\n    const top = (window.screen.height - height) / 2\n    const popup = window.open(this.#lumi.config.authOrigin, this.#popupName, `width=${width},height=${height},left=${left},top=${top}`)\n\n    let cleanup: () => void\n    return new Promise<MessageSignInData>((resolve, reject) => {\n      if (!popup)\n        return reject(new Error('Open auth window failed'))\n\n      const timer = setInterval(() => {\n        if (popup.closed)\n          reject(new Error('Auth window closed'))\n      }, 1000)\n\n      // 全局点击事件处理函数 - 重新聚焦popup并阻止事件传播\n      const handleGlobalClick = (event: MouseEvent): void => {\n        if (!popup.closed) {\n          popup.focus()\n          event.stopPropagation()\n          event.preventDefault()\n        }\n      }\n\n      const handleMessage = ({ data, origin, source }: MessageEvent<MessageDataReceive | null>): void => {\n        if (origin !== this.#lumi.config.authOrigin || source !== popup)\n          return\n\n        switch (data?.type) {\n          case MessageType.READY: {\n            popup.postMessage({\n              type: MessageType.INIT,\n              data: {\n                projectId: this.#lumi.config.projectId,\n                icon: getIcon(),\n                title: getTitle(),\n              },\n            } satisfies MessageDataSend, this.#lumi.config.authOrigin)\n            break\n          }\n          case MessageType.SIGN_IN: {\n            if (data.data.projectId !== this.#lumi.config.projectId)\n              break\n            popup.close()\n            window.focus()\n            this.accessToken = data.data.accessToken\n            this.user = data.data.user\n            resolve(data.data)\n            break\n          }\n        }\n      }\n\n      window.addEventListener('message', handleMessage)\n      // 添加全局点击事件监听器，使用捕获阶段确保优先处理\n      document.addEventListener('click', handleGlobalClick, true)\n\n      cleanup = () => {\n        clearInterval(timer)\n        window.removeEventListener('message', handleMessage)\n        document.removeEventListener('click', handleGlobalClick, true)\n      }\n    }).finally(() => cleanup?.())\n  }\n\n  /** 退出登录 */\n  public signOut(): void {\n    if (isServer)\n      throw new Error('auth.signOut() can only be called on the client side')\n\n    this.accessToken = null\n    this.user = null\n  }\n\n  /** 获取当前用户 */\n  public async refreshUser(): Promise<User> {\n    const res = await request<ApiResponse<User>>(this.#lumi, '/lm/user/info', {\n      method: 'POST',\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n    this.user = res.data\n    return res.data\n  }\n\n  /** 监听登录状态变化 */\n  public onAuthChange(callback: (args: {\n    isAuthenticated: boolean\n    user: User | null\n  }) => void): () => void {\n    if (isServer)\n      throw new Error('auth.onAuthChange() can only be called on the client side')\n\n    const handleStorageChange = (event: StorageEvent): void => {\n      if (event.key === StorageKey.ACCESS_TOKEN || event.key === StorageKey.USER || event.key === null) {\n        callback({\n          isAuthenticated: this.isAuthenticated,\n          user: this.user,\n        })\n      }\n    }\n\n    window.addEventListener('storage', handleStorageChange)\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange)\n    }\n  }\n}\n","import type { FetchOptions, ResponseType } from 'ofetch'\nimport type { LumiClient } from '@/core/lumi-client'\nimport Base64 from 'crypto-js/enc-base64'\nimport Hex from 'crypto-js/enc-hex'\nimport HmacSHA256 from 'crypto-js/hmac-sha256'\nimport SHA256 from 'crypto-js/sha256'\nimport hash from 'object-hash'\nimport { ofetch } from 'ofetch'\nimport { LumiError } from '@/lib/error'\nimport { isServer } from '@/utils/common'\n\nconst SECRET_KEY = '6QrJZ7pFCmBZAeIJF7IArvkCz+EtzA0RVcpHkiQIsQyhs7QtCS9P+CueZdHfB2OtJcgX3BbqY9pfpWeAVTqCwQ=='\n\n/** RFC 3986 compliant URI encoding */\nfunction rfc3986Encode(str: string): string {\n  return encodeURIComponent(str).replace(/[!'()*]/g, c => `%${c.charCodeAt(0).toString(16).toUpperCase()}`)\n}\n\n/** 添加签名 */\nfunction addSignature<T extends ResponseType>(options: FetchOptions<T>): void {\n  // 生成签名\n  const timestamp = Math.floor(Date.now() / 1000).toString()\n  const nonce = Math.random().toString(36).substring(2, 15)\n\n  // 构建查询字符串\n  const queryParams: Record<string, string> = { ...options.query, ...options.params }\n  const canonicalQueryString = Object.keys(queryParams).sort().map(key => `${rfc3986Encode(key)}=${rfc3986Encode(String(queryParams[key]))}`).join('&')\n\n  // 构建签名头\n  const headersToSign: Record<string, string> = {\n    'x-timestamp': timestamp,\n    'x-nonce': nonce,\n  }\n  const canonicalHeaders = Object.keys(headersToSign).sort().map(key => `${key}:${headersToSign[key]}`).join('\\n')\n\n  // 构建载荷哈希\n  const payload = (options.body && !(options.body instanceof FormData)) ? JSON.stringify(options.body) : ''\n  const hashedPayload = SHA256(payload).toString(Hex)\n\n  // 构建规范请求\n  const canonicalRequest = [canonicalQueryString, canonicalHeaders, hashedPayload].join('\\n')\n\n  // 生成签名\n  const signature = Base64.stringify(HmacSHA256(canonicalRequest, SECRET_KEY))\n\n  // 添加签名头到请求\n  const headers = new Headers(options.headers)\n  Object.entries(headersToSign).forEach(([key, value]) => {\n    headers.set(key, value)\n  })\n  headers.set('X-Sign', signature)\n  options.headers = headers\n}\n\nexport interface ApiResponse<T> {\n  code: number\n  message: string\n  data: T\n}\n\nexport interface PaginationData<T> {\n  total: number\n  list: T[]\n}\n\nconst requestMap = new Map<string, number[]>()\n\n/** 限制请求频率，相同参数的请求每秒只能发送4次 */\nfunction checkRateLimit<T extends ResponseType>(uri: string, options: FetchOptions<T>): void {\n  const clonedOptions = { ...options }\n\n  if (options.body instanceof FormData)\n    clonedOptions.body = Array.from(options.body.entries())\n\n  clonedOptions.headers = undefined\n\n  const requestHash = hash([uri, clonedOptions])\n  const now = Date.now()\n  const requestQueue = requestMap.get(requestHash)?.filter(time => now - time < 1000) || []\n  if (requestQueue.length >= 4)\n    throw new LumiError(429, 'Too many requests')\n  requestQueue.push(now)\n  requestMap.set(requestHash, requestQueue)\n}\n\nfunction beforeRequest<T extends ResponseType>(lumi: LumiClient, uri: string, options: FetchOptions<T>, stream: boolean = false): void {\n  options.headers = new Headers(options.headers)\n\n  // 添加认证头（如果存在）\n  if (lumi.auth.accessToken)\n    options.headers.set('Authorization', `Bearer ${lumi.auth.accessToken}`)\n\n  // 添加流式请求头\n  if (stream) {\n    if (!options.headers.get('Accept'))\n      options.headers.set('Accept', 'text/event-stream')\n    if (!options.headers.get('Cache-Control'))\n      options.headers.set('Cache-Control', 'no-cache')\n    if (!options.headers.get('X-Accel-Buffering'))\n      options.headers.set('X-Accel-Buffering', 'no')\n  }\n\n  // 限制请求频率\n  checkRateLimit(uri, options)\n\n  // 添加签名\n  addSignature(options)\n}\n\n/** 网络请求 */\nexport function request<T>(lumi: LumiClient, uri: string, options: FetchOptions<'json'> = {}): Promise<T> {\n  beforeRequest(lumi, uri, options)\n\n  const isAuthenticated = lumi.auth.isAuthenticated\n\n  return ofetch<T>(uri, {\n    baseURL: lumi.config.apiBaseUrl,\n    ...options,\n    onResponse: ({ response }) => {\n      // 若 Token 失效则退出登录\n      if (!isServer && isAuthenticated && (response._data as ApiResponse<any>)?.code === 2100)\n        lumi.auth.signOut()\n    },\n  })\n}\n\nexport type ApiStreamResponse = ReadableStream<Uint8Array>\n\n/** 网络请求（流式） */\nexport async function requestStream(lumi: LumiClient, uri: string, options: FetchOptions<'stream'> = {}): Promise<ApiStreamResponse> {\n  beforeRequest(lumi, uri, options, true)\n\n  const stream = await ofetch(uri, {\n    baseURL: lumi.config.apiBaseUrl,\n    ...options,\n    responseType: 'stream',\n  })\n\n  return stream\n}\n","export class LumiError extends Error {\n  name: string = 'LumiError'\n  code: number\n\n  constructor(code: number, message: string) {\n    super(message)\n    this.code = code\n  }\n}\n","export function getIcon(): string | null {\n  return document.querySelector<HTMLLinkElement>('link[rel=\"icon\"]')?.href ?? null\n}\n\nexport function getTitle(): string | null {\n  return document.title ?? null\n}\n\nexport const isServer = typeof window === 'undefined'\n\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function getEnv(key: string): string | null {\n  return typeof process !== 'undefined' ? process?.env[key] ?? null : null\n}\n","import type { StorageKey } from '@/constants'\n\nexport function setStorage<T>(key: StorageKey, value: T, storage: Storage = localStorage): void {\n  const oldValue = storage.getItem(key)\n  const newValue = value ? JSON.stringify(value) : null\n  if (newValue)\n    storage.setItem(key, newValue)\n  else\n    storage.removeItem(key)\n\n  window.dispatchEvent(new StorageEvent('storage', {\n    key,\n    oldValue,\n    newValue,\n    storageArea: storage,\n  }))\n}\n\nexport function getStorage<T>(key: StorageKey, storage: Storage = localStorage): T | null {\n  const value = storage.getItem(key)\n  try {\n    return value ? JSON.parse(value) : null\n  }\n  catch (_e) {\n    return null\n  }\n}\n","import type { LumiClient } from '@/core/lumi-client'\nimport type { ApiResponse, PaginationData } from '@/lib/request'\nimport { request } from '@/lib/request'\n\nexport interface Entity extends Record<string, any> {\n  id: string\n}\n\nexport class EntityClient {\n  readonly #lumi: LumiClient\n  public readonly entityName: string\n\n  constructor(lumi: LumiClient, entityName: string) {\n    this.#lumi = lumi\n    this.entityName = entityName\n  }\n\n  /** 查询文档列表 */\n  public async list({ filter, sort, limit, skip }: {\n    filter?: any\n    sort?: Record<string, 1 | -1>\n    limit?: number\n    skip?: number\n  } = {}): Promise<PaginationData<Entity>> {\n    if (!limit) {\n      const res = await request<ApiResponse<Entity[]>>(this.#lumi, this.uri('/list'), {\n        method: 'POST',\n        body: { filter, sort },\n      })\n      if (res.code !== 200)\n        throw new Error(res.message)\n      return {\n        total: res.data.length,\n        list: res.data,\n      }\n    }\n    else {\n      const res = await request<ApiResponse<PaginationData<Entity>>>(this.#lumi, this.uri('/find'), {\n        method: 'POST',\n        body: { filter, sort, limit, skip },\n      })\n      if (res.code !== 200)\n        throw new Error(res.message)\n      return res.data\n    }\n  }\n\n  /** 获取单个文档 */\n  public async get(id: string): Promise<Entity | null> {\n    const res = await request<ApiResponse<Entity>>(this.#lumi, this.uri(`/${id}`), {\n      method: 'GET',\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n    return res.data\n  }\n\n  /** 创建文档 */\n  public async create(data: Record<string, any>): Promise<Entity> {\n    const res = await request<ApiResponse<Entity>>(this.#lumi, this.uri(), {\n      method: 'POST',\n      body: data,\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n    return res.data\n  }\n\n  /** 批量创建文档 */\n  public async createMany(data: Record<string, any>[]): Promise<Entity[]> {\n    const res = await request<ApiResponse<Entity[]>>(this.#lumi, this.uri('/batch'), {\n      method: 'POST',\n      body: data,\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n    return res.data\n  }\n\n  /** 更新文档 */\n  public async update(id: string, data: Record<string, any>): Promise<Entity> {\n    const res = await request<ApiResponse<Entity>>(this.#lumi, this.uri(), {\n      method: 'PUT',\n      body: { filter: { _id: id }, update: data },\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n    return res.data\n  }\n\n  /** 删除文档 */\n  public async delete(id: string): Promise<void> {\n    const res = await request<ApiResponse<null>>(this.#lumi, this.uri(`/${id}`), {\n      method: 'DELETE',\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n  }\n\n  /** 批量删除文档 */\n  public async deleteMany(ids: string[]): Promise<void> {\n    const res = await request<ApiResponse<null>>(this.#lumi, this.uri('/batch-by-ids'), {\n      method: 'DELETE',\n      params: { ids },\n    })\n    if (res.code !== 200)\n      throw new Error(res.message)\n  }\n\n  private uri(suffix = ''): string {\n    return `/lm/${this.#lumi.config.projectId}/${this.entityName}/documents${suffix}`\n  }\n}\n","import type { LumiClient } from '@/core/lumi-client'\nimport { EntityClient } from '@/core/entity-client'\n\nexport class EntitiesClient {\n  readonly #lumi: LumiClient\n  [key: string]: EntityClient\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n    return new Proxy(this, {\n      get(target: EntitiesClient, p: string) {\n        if (!(p in target))\n          target[p] = new EntityClient(target.#lumi, p)\n        return target[p]\n      },\n    }) as this\n  }\n}\n","import type { FetchOptions } from 'ofetch'\nimport type { LumiClient } from '@/core/lumi-client'\nimport { ofetch } from 'ofetch'\n\nexport class FunctionsClient {\n  readonly #lumi: LumiClient\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n  }\n\n  public invoke(functionName: string, options: FetchOptions = {}): Promise<any> {\n    if (this.#lumi.auth.accessToken) {\n      options.headers = {\n        Authorization: `Bearer ${this.#lumi.auth.accessToken}`,\n        ...options.headers,\n      }\n    }\n\n    return ofetch(`/v1/functions/${this.#lumi.config.projectId}/${functionName}`, {\n      baseURL: this.#lumi.config.apiBaseUrl,\n      ...options,\n    })\n  }\n}\n","import type { LumiClient } from '@/core/lumi-client'\nimport type { ApiResponse, ApiStreamResponse } from '@/lib/request'\nimport { EventSourceParserStream } from 'eventsource-parser/stream'\nimport { LumiError } from '@/lib/error'\nimport { requestStream } from '@/lib/request'\nimport { request } from '@/lib/request'\nimport { delay, getEnv, isServer } from '@/utils/common'\n\nexport interface MessageMedia {\n  mimeType: string\n  url: string\n}\n\nexport interface Message {\n  role: 'system' | 'user' | 'assistant'\n  content: string\n  medias?: MessageMedia[]\n}\n\nexport interface GenerateTextResult {\n  chatId: string\n  content: string\n}\n\nexport interface GenerateImageResult {\n  chatId: string\n  messageId: string\n  generationStatus: 'PROCESSING' | 'SUCCESS' | 'FAILED'\n  content?: string\n  imageURL?: string\n}\n\nexport interface StreamChunk<T> {\n  event?: string\n  data: T\n}\n\nexport class AITool {\n  readonly #lumi: LumiClient\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n  }\n\n  /** AI 生成文本 */\n  public async generateText({\n    model = 'gemini-2.5-flash',\n    messages,\n  }: {\n    model?: string\n    messages: Message[]\n  }): Promise<GenerateTextResult> {\n    const lumiApiKey = this.checkLumiApiKey()\n\n    const res = await request<ApiResponse<GenerateTextResult>>(this.#lumi, `/lm/${this.#lumi.config.projectId}/ai/chat/completions`, {\n      method: 'POST',\n      body: {\n        lumiApiKey,\n        modelName: model,\n        chatMessages: messages,\n      },\n    })\n\n    if (res.code !== 200)\n      throw new LumiError(res.code, res.message)\n\n    return res.data\n  }\n\n  /** AI 生成文本（流式输出） */\n  public async generateTextStream({\n    model = 'gemini-2.5-flash',\n    messages,\n  }: {\n    model?: string\n    messages: Message[]\n  }): Promise<ApiStreamResponse> {\n    const lumiApiKey = this.checkLumiApiKey()\n\n    return requestStream(this.#lumi, `/lm/${this.#lumi.config.projectId}/ai/chat/stream`, {\n      method: 'POST',\n      body: {\n        lumiApiKey,\n        modelName: model,\n        chatMessages: messages,\n      },\n    })\n  }\n\n  /** AI 生成图片 */\n  public async generateImage({\n    model = 'gemini-2.5-flash-image',\n    messages,\n  }: {\n    model?: string\n    messages: Message[]\n  }): Promise<GenerateImageResult> {\n    const lumiApiKey = this.checkLumiApiKey()\n\n    const { code, message, data } = await request<ApiResponse<GenerateImageResult>>(this.#lumi, `/lm/${this.#lumi.config.projectId}/ai/image/task`, {\n      method: 'POST',\n      body: {\n        lumiApiKey,\n        modelName: model,\n        chatMessages: messages,\n      },\n    })\n    if (code !== 200)\n      throw new LumiError(code, message)\n\n    let result = data\n    let delayMs = 1000\n\n    // 轮询生成结果\n    while (result.generationStatus === 'PROCESSING') {\n      await delay(delayMs)\n      if (delayMs < 5000)\n        delayMs += 500\n\n      const { code, message, data } = await request<ApiResponse<GenerateImageResult>>(this.#lumi, `/lm/${this.#lumi.config.projectId}/ai/image/get`, {\n        method: 'POST',\n        body: {\n          lumiApiKey,\n          messageId: result.messageId,\n        },\n      })\n      if (code !== 200)\n        throw new LumiError(code, message)\n      result = data\n    }\n\n    return result\n  }\n\n  /** 解析流式输出（将原始 SSE 流解析为 GenerateTextResult 块） */\n  public async parseStream(stream: ApiStreamResponse): Promise<ReadableStream<StreamChunk<GenerateTextResult>>> {\n    return stream\n      .pipeThrough(new TextDecoderStream())\n      .pipeThrough(new EventSourceParserStream())\n      .pipeThrough<StreamChunk<GenerateTextResult>>(new TransformStream({\n        transform: (chunk, controller) => {\n          try {\n            const data = JSON.parse(chunk.data)\n            controller.enqueue({\n              event: chunk.event,\n              data,\n            })\n          }\n          catch {\n            console.error(`Parse stream chunk failed: Invalid JSON.\\n${chunk.data}`)\n          }\n        },\n      }))\n  }\n\n  private checkLumiApiKey(): string {\n    if (!isServer)\n      throw new LumiError(400, 'lumi.tools.ai is only available on the server-side')\n\n    const lumiApiKey = getEnv('LUMI_API_KEY')\n    if (!lumiApiKey)\n      throw new LumiError(400, 'LUMI_API_KEY is required')\n\n    return lumiApiKey\n  }\n}\n","import type { LumiClient } from '@/core/lumi-client'\nimport type { ApiResponse } from '@/lib/request'\nimport { LumiError } from '@/lib/error'\nimport { request } from '@/lib/request'\n\nexport class EmailTool {\n  readonly #lumi: LumiClient\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n  }\n\n  /** 发送邮件 */\n  public async send({ to, subject, fromName, html, text = '', replyTo, scheduledAt }: {\n    to: string | string[]\n    subject: string\n    fromName?: string\n    html?: string\n    text?: string\n    replyTo?: string | string[]\n    scheduledAt?: string\n  }): Promise<void> {\n    if (!to || !subject || (!html && !text))\n      throw new Error('Failed to send email: Missing required parameters.')\n\n    if (typeof to === 'string')\n      to = [to]\n    if (typeof replyTo === 'string')\n      replyTo = [replyTo]\n\n    const res = await request<ApiResponse<null>>(this.#lumi, `/lm/${this.#lumi.config.projectId}/email/send`, {\n      method: 'POST',\n      body: { to, subject, fromName, html, text, replyTo, scheduledAt },\n    })\n\n    if (res.code !== 200)\n      throw new LumiError(res.code, res.message)\n  }\n}\n","import type { LumiClient } from '@/core/lumi-client'\nimport type { ApiResponse } from '@/lib/request'\nimport { LumiError } from '@/lib/error'\nimport { request } from '@/lib/request'\n\nexport interface UploadItem {\n  fileName: string\n  fileUrl?: string\n  uploadError?: string\n}\n\nexport class FileTool {\n  readonly #lumi: LumiClient\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n  }\n\n  /** 上传文件 */\n  public async upload(files: File[]): Promise<UploadItem[]> {\n    const formData = new FormData()\n    files.forEach((file) => {\n      formData.append('files', file)\n    })\n\n    const res = await request<ApiResponse<UploadItem[]>>(this.#lumi, `/lm/${this.#lumi.config.projectId}/file/batch`, {\n      method: 'POST',\n      body: formData,\n    })\n\n    if (res.code !== 200)\n      throw new LumiError(res.code, res.message)\n\n    return res.data\n  }\n\n  /** 批量删除文件 */\n  public async delete(fileUrls: string[]): Promise<void> {\n    const res = await request<ApiResponse<null>>(this.#lumi, `/lm/${this.#lumi.config.projectId}/file/batch`, {\n      method: 'DELETE',\n      body: { fileUrls },\n    })\n\n    if (res.code !== 200)\n      throw new LumiError(res.code, res.message)\n  }\n}\n","import type { LumiClient } from '@/core/lumi-client'\nimport { AITool, EmailTool, FileTool } from '@/tools'\n\nexport class ToolsClient {\n  readonly #lumi: LumiClient\n\n  public email: EmailTool\n  public file: FileTool\n  public ai: AITool\n\n  constructor(lumi: LumiClient) {\n    this.#lumi = lumi\n    this.email = new EmailTool(lumi)\n    this.file = new FileTool(lumi)\n    this.ai = new AITool(lumi)\n  }\n}\n","import { LumiAuthClient } from '@/core/auth-client'\nimport { EntitiesClient } from '@/core/entities-client'\nimport { FunctionsClient } from '@/core/functions-client'\nimport { ToolsClient } from '@/core/tools-client'\n\nexport interface LumiClientConfig {\n  projectId: string\n  apiBaseUrl: string\n  authOrigin: string\n  authorization?: string\n}\n\nexport class LumiClient {\n  public config: LumiClientConfig\n\n  public auth: LumiAuthClient\n  public entities: EntitiesClient\n  public tools: ToolsClient\n  public functions: FunctionsClient\n\n  constructor(config: LumiClientConfig) {\n    this.config = config\n    this.auth = new LumiAuthClient(this)\n    this.entities = new EntitiesClient(this)\n    this.tools = new ToolsClient(this)\n    this.functions = new FunctionsClient(this)\n  }\n}\n\nexport function createClient(config: LumiClientConfig): LumiClient {\n  return new LumiClient(config)\n}\n"],"mappings":"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","names":["v4","Base64","Hex","HmacSHA256","SHA256","hash","ofetch","LumiError","code","message","getIcon","_a","_b","getTitle","isServer","delay","ms","resolve","getEnv","key","SECRET_KEY","rfc3986Encode","str","c","addSignature","options","timestamp","nonce","queryParams","__spreadValues","canonicalQueryString","key","headersToSign","canonicalHeaders","payload","hashedPayload","SHA256","Hex","canonicalRequest","signature","Base64","HmacSHA256","headers","value","requestMap","checkRateLimit","uri","_a","clonedOptions","requestHash","hash","now","requestQueue","time","LumiError","beforeRequest","lumi","stream","request","isAuthenticated","ofetch","__spreadProps","response","isServer","requestStream","_0","_1","__async","setStorage","key","value","storage","oldValue","newValue","getStorage","_e","_lumi","_popupName","_user","LumiAuthClient","lumi","__privateAdd","v4","__privateSet","isServer","authorization","__privateGet","getStorage","accessToken","setStorage","user","width","height","left","top","popup","cleanup","resolve","reject","timer","handleGlobalClick","event","handleMessage","data","origin","source","getIcon","getTitle","__async","res","request","callback","handleStorageChange","_lumi","EntityClient","lumi","entityName","__privateAdd","__privateSet","__async","filter","sort","limit","skip","res","request","__privateGet","id","data","ids","suffix","_lumi","EntitiesClient","lumi","__privateAdd","__privateSet","target","p","EntityClient","__privateGet","ofetch","_lumi","FunctionsClient","lumi","__privateAdd","__privateSet","functionName","options","__privateGet","__spreadValues","ofetch","EventSourceParserStream","_lumi","AITool","lumi","__privateAdd","__privateSet","_0","__async","model","messages","lumiApiKey","res","request","__privateGet","LumiError","requestStream","code","message","data","result","delayMs","delay","stream","EventSourceParserStream","chunk","controller","e","isServer","getEnv","_lumi","EmailTool","lumi","__privateAdd","__privateSet","_0","__async","to","subject","fromName","html","text","replyTo","scheduledAt","res","request","__privateGet","LumiError","_lumi","FileTool","lumi","__privateAdd","__privateSet","files","__async","formData","file","res","request","__privateGet","LumiError","fileUrls","_lumi","ToolsClient","lumi","__privateAdd","__privateSet","EmailTool","FileTool","AITool","LumiClient","config","LumiAuthClient","EntitiesClient","ToolsClient","FunctionsClient","createClient"]}